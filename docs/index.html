<!DOCTYPE html>
<html lang="en">

<head>
    <title>LoL Tracker - Recherche</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="bootstrap-5.1.3.min.css">
    <link rel="stylesheet" type="text/css" href="index.css">
    
    <script src="plotly-latest.min.js"></script>
    <style>
        /* Un peu de CSS pour centrer la recherche comme sur OP.GG */
        body {
            background-color: #1c1c1f; /* Fond sombre style LoL */
            color: white;
        }
        .search-container {
            margin-top: 100px;
            text-align: center;
        }
        .logo-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 30px;
            color: #00b4ff;
        }
        .search-box {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }
        .form-control-lg {
            border-radius: 50px;
            padding-left: 25px;
        }
        .btn-search {
            position: absolute;
            right: 5px;
            top: 5px;
            border-radius: 50px;
            padding: 8px 25px;
        }
        /* Style pour la carte de résultat */
        #profile-card {
            display: none; /* Caché par défaut */
            background: #2a2a2e;
            max-width: 600px;
            margin: 50px auto;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .rank-tier {
            font-size: 1.5rem;
            color: #f1c40f; /* Couleur Or */
            font-weight: bold;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1 ms-3">LoL Tracker Open Source</span>
        </div>
    </nav>

    <div class="container search-container">
        <h1 class="logo-title">GG.TRACKER</h1>
        
        <div class="search-box">
            <div class="input-group input-group-lg">
                <input type="text" id="searchInput" class="form-control form-control-lg" placeholder="Nom#Tag (ex: Faker#KR1, Agurin#EUW)...">
                <button class="btn btn-primary btn-search" type="button" onclick="searchPlayer()">Rechercher</button>
            </div>
            <p class="mt-2 text-muted">Région configurée: EUW (Changeable dans le Python)</p>
        </div>
    </div>

    <div id="profile-card" class="container">
        <div class="row align-items-center">
            <div class="col-3 text-center">
                <img id="profileIcon" src="https://ddragon.leagueoflegends.com/cdn/13.24.1/img/profileicon/29.png" class="img-fluid rounded-circle" style="border: 3px solid #00b4ff;">
                <span id="levelBadge" class="badge bg-dark mt-2">Niveau 0</span>
            </div>
            <div class="col-9">
                <h2 id="summonerName">Nom du Joueur</h2>
                <hr style="border-color: #555;">
                <div id="rankContainer">
                    <p class="mb-0 text-muted">Classé Solo/Duo</p>
                    <div class="rank-tier" id="soloRank">UNRANKED</div>
                    <p id="winLoss" class="small">0W 0L</p>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed-bottom text-center pb-3 text-muted">
        <small>Powered by Riot API & Open Source Community</small>
    </div>

    <script>
        async function searchPlayer() {
            const input = document.getElementById('searchInput').value;
            const profileCard = document.getElementById('profile-card');
            
            // 1. Validation basique
            if (!input.includes('#')) {
                alert("Format invalide ! Utilisez le format : Nom#Tag");
                return;
            }

            const [gameName, tagLine] = input.split('#');
            
            // Afficher un état de chargement
            document.getElementById('summonerName').innerText = "Chargement...";
            profileCard.style.display = 'block';

            // 2. Appel au serveur Python (Assurez-vous que app.py tourne !)
            // Note: On utilise encodeURIComponent pour gérer les espaces ou caractères spéciaux
            const url = `http://127.0.0.1:5000/recherche/${encodeURIComponent(gameName)}/${encodeURIComponent(tagLine)}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    alert("Erreur: " + data.error);
                    profileCard.style.display = 'none';
                    return;
                }

                // 3. Mise à jour de l'affichage avec les vraies données
                
                // Nom & Niveau
                document.getElementById('summonerName').innerText = `${data.account.gameName} #${data.account.tagLine}`;
                document.getElementById('levelBadge').innerText = "Niveau " + data.profil.summonerLevel;
                
                // Icône (Utilisation de CommunityDragon ou DDragon)
                document.getElementById('profileIcon').src = `https://ddragon.leagueoflegends.com/cdn/14.23.1/img/profileicon/${data.profil.profileIconId}.png`;

                // Gestion du rang (Solo Duo)
                // On cherche la queueType "RANKED_SOLO_5x5" dans le tableau
                const soloQ = data.rangs.find(q => q.queueType === "RANKED_SOLO_5x5");

                if (soloQ) {
                    document.getElementById('soloRank').innerText = `${soloQ.tier} ${soloQ.rank} - ${soloQ.leaguePoints} LP`;
                    document.getElementById('soloRank').style.color = getRankColor(soloQ.tier);
                    document.getElementById('winLoss').innerText = `${soloQ.wins}W / ${soloQ.losses}L (Winrate ${Math.round((soloQ.wins / (soloQ.wins + soloQ.losses)) * 100)}%)`;
                } else {
                    document.getElementById('soloRank').innerText = "UNRANKED";
                    document.getElementById('soloRank').style.color = "#888";
                    document.getElementById('winLoss').innerText = "Aucune partie classée";
                }

            } catch (error) {
                console.error(error);
                alert("Impossible de contacter le serveur Python. Vérifiez qu'il est lancé !");
            }
        }

        // Petit bonus pour la couleur du rang
        function getRankColor(tier) {
            const colors = {
                "IRON": "#5e5e5e",
                "BRONZE": "#cd7f32",
                "SILVER": "#c0c0c0",
                "GOLD": "#f1c40f",
                "PLATINUM": "#2ecc71",
                "EMERALD": "#009e60",
                "DIAMOND": "#3498db",
                "MASTER": "#9b59b6",
                "GRANDMASTER": "#e74c3c",
                "CHALLENGER": "#f39c12"
            };
            return colors[tier] || "white";
        }
    </script>
</body>
</html>